# Alpha Pilot Bot OKX ä¿®æ”¹ä¼˜åŒ–æŒ‡å—

## ğŸ¯ å¿«é€Ÿä¿®æ”¹å‚è€ƒ

### ğŸ“ˆ è°ƒæ•´äº¤æ˜“æ¿€è¿›ç¨‹åº¦

#### è®©ç³»ç»Ÿæ›´æ¿€è¿›ï¼ˆå¢åŠ äº¤æ˜“é¢‘ç‡ï¼‰
```yaml
# config.yaml ä¿®æ”¹
ai:
  consensus_threshold: 0.5      # ä»0.8é™ä½åˆ°0.5
  majority_threshold: 0.4       # ä»0.6é™ä½åˆ°0.4
  confidence_adjustment: 0.8    # ä»0.7æé«˜åˆ°0.8

trading:
  min_trade_amount: 0.001       # ä¿æŒæœ€å°å€¼
  max_position_size: 0.02       # ä»0.01æé«˜åˆ°0.02
```

#### è®©ç³»ç»Ÿæ›´ä¿å®ˆï¼ˆå‡å°‘äº¤æ˜“é¢‘ç‡ï¼‰
```yaml
# config.yaml ä¿®æ”¹
ai:
  consensus_threshold: 0.9      # ä»0.8æé«˜åˆ°0.9
  majority_threshold: 0.7       # ä»0.6æé«˜åˆ°0.7
  confidence_adjustment: 0.5    # ä»0.7é™ä½åˆ°0.5

trading:
  min_trade_amount: 0.005       # ä»0.001æé«˜åˆ°0.005
  max_position_size: 0.005      # ä»0.01é™ä½åˆ°0.005
```

---

### ğŸ¯ ä¼˜åŒ–AIä¿¡å·èåˆ

#### åœºæ™¯1: æŸä¸ªAIæä¾›å•†ç»å¸¸å¤±è´¥
**æ–‡ä»¶**: `ai_client.py`
**æ–¹æ³•**: `get_multi_ai_signals()`

```python
# ä¿®æ”¹é‡è¯•æ¬¡æ•°å’Œè¶…æ—¶æ—¶é—´
max_retries = 3  # ä»2å¢åŠ åˆ°3
timeout = 35.0   # ä»25ç§’å¢åŠ åˆ°35ç§’

# ä¿®æ”¹å¤±è´¥å¤„ç†é€»è¾‘
if not provider_success:
    failed_providers.append(provider)
    log_warning(f"âš ï¸ {provider}è¿ç»­å¤±è´¥ï¼Œæš‚æ—¶é™ä½æƒé‡")
    # å¯ä»¥æ·»åŠ æƒé‡é™ä½é€»è¾‘
```

#### åœºæ™¯2: è°ƒæ•´AIä¿¡å·æƒé‡
**æ–‡ä»¶**: `ai_client.py`
**æ–¹æ³•**: `fuse_signals()`

```python
# ä¿®æ”¹ä¿¡å¿ƒè°ƒæ•´é€»è¾‘
# ä¸ºä¸åŒæä¾›å•†è®¾ç½®ä¸åŒæƒé‡
provider_weights = {
    'deepseek': 1.2,  # æé«˜deepseekæƒé‡
    'kimi': 1.0,      # æ ‡å‡†æƒé‡
    'openai': 0.8     # é™ä½openaiæƒé‡
}

# åº”ç”¨æƒé‡è°ƒæ•´
weighted_confidence = confidence * provider_weights.get(provider, 1.0)
```

---

### ğŸ’° è°ƒæ•´é£é™©ç®¡ç†ç­–ç•¥

#### åœºæ™¯1:  tighteræ­¢æŸï¼ˆæ›´ä¸¥æ ¼ï¼‰
**æ–‡ä»¶**: `main.py`
**æ–¹æ³•**: `_update_risk_management()`

```python
# ä¿®æ”¹é£é™©é˜ˆå€¼
high_risk_threshold = 0.08      # ä»0.10é™ä½åˆ°0.08
medium_risk_threshold = 0.03    # ä»0.05é™ä½åˆ°0.03

# ä¿®æ”¹æ­¢ç›ˆæ­¢æŸå€æ•°
base_sl_pct = 0.015             # ä»0.02é™ä½åˆ°0.015
base_tp_pct = 0.04              # ä»0.06é™ä½åˆ°0.04
```

#### åœºæ™¯2: æ›´å®½æ¾çš„æ­¢æŸï¼ˆæ›´å®½æ¾ï¼‰
**æ–‡ä»¶**: `main.py`
**æ–¹æ³•**: `_update_risk_management()`

```python
# ä¿®æ”¹é£é™©é˜ˆå€¼
high_risk_threshold = 0.15      # ä»0.10æé«˜åˆ°0.15
medium_risk_threshold = 0.08    # ä»0.05æé«˜åˆ°0.08

# ä¿®æ”¹æ­¢ç›ˆæ­¢æŸå€æ•°
base_sl_pct = 0.03              # ä»0.02æé«˜åˆ°0.03
base_tp_pct = 0.08              # ä»0.06æé«˜åˆ°0.08
```

---

### ğŸ“Š ä¼˜åŒ–æ¨ªç›˜æ£€æµ‹

#### åœºæ™¯1: æ›´æ•æ„Ÿçš„æ¨ªç›˜æ£€æµ‹
**æ–‡ä»¶**: `strategies.py`
**æ–¹æ³•**: `detect_consolidation()`

```python
# é™ä½é˜ˆå€¼ï¼Œæ›´å®¹æ˜“è§¦å‘æ¨ªç›˜
price_range_threshold = 0.015   # ä»0.02é™ä½åˆ°0.015
duration_threshold = 20         # ä»30åˆ†é’Ÿé™ä½åˆ°20åˆ†é’Ÿ
profit_threshold = 0.005        # ä»0.01é™ä½åˆ°0.005
```

#### åœºæ™¯2: æ›´è¿Ÿé’çš„æ¨ªç›˜æ£€æµ‹
**æ–‡ä»¶**: `strategies.py`
**æ–¹æ³•**: `detect_consolidation()`

```python
# æé«˜é˜ˆå€¼ï¼Œæ›´éš¾è§¦å‘æ¨ªç›˜
price_range_threshold = 0.03    # ä»0.02æé«˜åˆ°0.03
duration_threshold = 45         # ä»30åˆ†é’Ÿæé«˜åˆ°45åˆ†é’Ÿ
profit_threshold = 0.02         # ä»0.01æé«˜åˆ°0.02
```

---

### ğŸ”§ ä¿®å¤åˆçº¦æ•°é‡é—®é¢˜

#### åœºæ™¯1: æ–°çš„ç‰¹æ®Šæ•°é‡å¤„ç†
**æ–‡ä»¶**: `trading.py`
**æ–¹æ³•**: `_standardize_close_amount()`

```python
# æ·»åŠ æ–°çš„ç‰¹æ®Šæ•°é‡èŒƒå›´
# é’ˆå¯¹0.015çš„ç‰¹æ®Šå¤„ç†
if 0.01 <= amount <= 0.02:
    multiplier = max(1, int(round(amount / 0.005)))
    candidate = multiplier * 0.005
    if candidate >= min_sz:
        log_info(f"0.015ç‰¹æ®Šå¤„ç†: {amount} -> {candidate}")
        return candidate

# æ·»åŠ æ–°çš„lot sizeå€™é€‰
common_lot_sizes = [0.0005, 0.001, 0.005, 0.01, 0.1]  # æ·»åŠ 0.0005å’Œ0.005
```

#### åœºæ™¯2: æ›´æ¿€è¿›çš„æ ‡å‡†åŒ–
**æ–‡ä»¶**: `trading.py`
**æ–¹æ³•**: `_standardize_close_amount()`

```python
# ä¿®æ”¹æ™ºèƒ½å››èˆäº”å…¥é€»è¾‘
if amount < 0.005:           # ä»0.01é™ä½åˆ°0.005
    standardized = round(amount, 4)  # ä»3ä½ç²¾åº¦æé«˜åˆ°4ä½
elif amount < 0.05:          # ä»0.1é™ä½åˆ°0.05
    standardized = round(amount, 3)  # ä¿æŒ3ä½ç²¾åº¦
else:
    standardized = round(amount, 2)  # ä»1ä½æé«˜åˆ°2ä½
```

---

### ğŸš€ æ€§èƒ½ä¼˜åŒ–

#### åœºæ™¯1: å‡å°‘APIè°ƒç”¨é¢‘ç‡
**æ–‡ä»¶**: `main.py`
**æ–¹æ³•**: `execute_trading_cycle()`

```python
# ä¿®æ”¹ç¼“å­˜ç­–ç•¥
# åœ¨è·å–AIä¿¡å·å‰å¢åŠ é¢å¤–ç¼“å­˜æ£€æŸ¥
if self._should_use_cached_signal(market_data):
    log_info("ä½¿ç”¨ç¼“å­˜ä¿¡å·ï¼Œå‡å°‘APIè°ƒç”¨")
    return cached_signal

# å»¶é•¿ç¼“å­˜æ—¶é—´
cache_manager.set(cache_key, signal_data, config.get('ai', 'cache_duration') * 2)
```

#### åœºæ™¯2: ä¼˜åŒ–å†…å­˜ä½¿ç”¨
**æ–‡ä»¶**: `main.py`
**æ–¹æ³•**: `_perform_system_maintenance()`

```python
# å¢åŠ æ¸…ç†é¢‘ç‡
if self.state.current_cycle % 5 == 0:  # ä»æ¯10è½®æ”¹ä¸ºæ¯5è½®
    memory_stats = memory_manager.get_memory_stats()
    # ä¸»åŠ¨æ¸…ç†å¤§å¯¹è±¡
    memory_manager.cleanup_large_objects()
```

---

## ğŸ§ª æµ‹è¯•éªŒè¯æ­¥éª¤

### 1. è¯­æ³•æ£€æŸ¥
```bash
python3 syntax_check.py
```

### 2. æ¨¡æ‹Ÿæ¨¡å¼æµ‹è¯•
```bash
# ä¿®æ”¹config.yaml
trading:
  test_mode: true

# è¿è¡Œç³»ç»Ÿ
python3 main.py
```

### 3. å…³é”®åœºæ™¯éªŒè¯
```bash
# æµ‹è¯•AIæä¾›å•†å¤±è´¥åœºæ™¯
# ä¸´æ—¶ä¿®æ”¹APIå¯†é’¥ä¸ºé”™è¯¯å€¼
# è§‚å¯Ÿå®¹é”™å¤„ç†æ˜¯å¦æ­£å¸¸

# æµ‹è¯•ç‰¹æ®Šåˆçº¦æ•°é‡
# æ‰‹åŠ¨è®¾ç½®position sizeä¸º0.025
# è§‚å¯Ÿæ ‡å‡†åŒ–è¿‡ç¨‹æ—¥å¿—

# æµ‹è¯•é£é™©ç®¡ç†
# æ‰‹åŠ¨ä¿®æ”¹æŒä»“ç›ˆäºçŠ¶æ€
# è§‚å¯Ÿé£é™©ç®¡ç†å»ºè®®æ˜¯å¦åˆç†
```

### 4. æ—¥å¿—åˆ†æè¦ç‚¹
- âœ… AIä¿¡å·èåˆæˆåŠŸç‡
- âœ… åˆçº¦æ ‡å‡†åŒ–æˆåŠŸç‡
- âœ… é£é™©ç®¡ç†è§¦å‘é¢‘ç‡
- âœ… æ¨ªç›˜æ£€æµ‹å‡†ç¡®æ€§
- âœ… å¼‚å¸¸å¤„ç†å®Œæ•´æ€§

---

## ğŸ“‹ å¸¸è§é—®é¢˜å¿«é€Ÿè§£å†³

### é—®é¢˜1: AIä¿¡å·è·å–å¤±è´¥é¢‘ç¹
**è§£å†³æ–¹æ¡ˆ**:
1. å¢åŠ é‡è¯•æ¬¡æ•°å’Œè¶…æ—¶æ—¶é—´
2. æ£€æŸ¥ç½‘ç»œè¿æ¥ç¨³å®šæ€§
3. éªŒè¯APIå¯†é’¥æœ‰æ•ˆæ€§
4. è€ƒè™‘å‡å°‘AIæä¾›å•†æ•°é‡

### é—®é¢˜2: åˆçº¦æ•°é‡æ ‡å‡†åŒ–å¤±è´¥
**è§£å†³æ–¹æ¡ˆ**:
1. æ·»åŠ æ–°çš„lot sizeå€™é€‰å€¼
2. è°ƒæ•´ç‰¹æ®Šå¤„ç†èŒƒå›´
3. å¢å¼ºé™çº§ç­–ç•¥
4. æ£€æŸ¥äº¤æ˜“æ‰€å®é™…åˆçº¦è§„æ ¼

### é—®é¢˜3: é£é™©ç®¡ç†è¿‡äºé¢‘ç¹è§¦å‘
**è§£å†³æ–¹æ¡ˆ**:
1. è°ƒæ•´é£é™©é˜ˆå€¼å‚æ•°
2. ä¼˜åŒ–æ­¢ç›ˆæ­¢æŸè®¡ç®—é€»è¾‘
3. å¢åŠ ç¼“å†²åŒºé—´
4. è€ƒè™‘å¸‚åœºæ³¢åŠ¨æ€§è°ƒæ•´

### é—®é¢˜4: æ¨ªç›˜æ£€æµ‹è¯¯æŠ¥ç‡é«˜
**è§£å†³æ–¹æ¡ˆ**:
1. æé«˜ä»·æ ¼æ³¢åŠ¨é˜ˆå€¼
2. å»¶é•¿æŒç»­æ—¶é—´è¦æ±‚
3. å¢åŠ ç¡®è®¤æ¡ä»¶
4. ç»“åˆæ›´å¤šæŠ€æœ¯æŒ‡æ ‡

---

## âš ï¸ é‡è¦æé†’

### ä¿®æ”¹å‰å¿…åš
1. âœ… å¤‡ä»½åŸå§‹é…ç½®æ–‡ä»¶
2. âœ… è®°å½•å½“å‰å‚æ•°è®¾ç½®
3. âœ… å‡†å¤‡å›æ»šæ–¹æ¡ˆ
4. âœ… è®¾ç½®ç›‘æ§å‘Šè­¦

### ä¿®æ”¹åŸåˆ™
1. âœ… ä¸€æ¬¡åªä¿®æ”¹ä¸€ä¸ªå‚æ•°
2. âœ… å°å¹…åº¦é€æ­¥è°ƒæ•´
3. âœ… å……åˆ†æµ‹è¯•éªŒè¯
4. âœ… è®°å½•ä¿®æ”¹åŸå› 

### ç›‘æ§æŒ‡æ ‡
1. ğŸ“Š äº¤æ˜“æˆåŠŸç‡å˜åŒ–
2. ğŸ“Š ç›ˆäºæ¯”ä¾‹å˜åŒ–
3. ğŸ“Š ç³»ç»Ÿç¨³å®šæ€§æŒ‡æ ‡
4. ğŸ“Š å¼‚å¸¸å‘ç”Ÿé¢‘ç‡

---

## ğŸ”— ç›¸å…³æ–‡æ¡£é“¾æ¥

- [ä¸šåŠ¡é€»è¾‘æµç¨‹å›¾](BUSINESS_LOGIC_FLOWCHART.md) - å®Œæ•´ä¸šåŠ¡æµç¨‹å›¾
- [è¯¦ç»†å†³ç­–åˆ†æ”¯](DETAILED_DECISION_BRANCHES.md) - å…³é”®å†³ç­–ç‚¹è¯¦è§£
- [ç»¼åˆä¿®å¤æ€»ç»“](COMPREHENSIVE_FIXES_SUMMARY.md) - å†å²ä¿®å¤è®°å½•

---

*æœ€åæ›´æ–°: 2025å¹´12æœˆ6æ—¥*
*ç‰ˆæœ¬: v1.0 - å¿«é€Ÿä¿®æ”¹æŒ‡å—*